

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ufoLib &mdash; RoboFab 1.3.0a documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3.0a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="RoboFab 1.3.0a documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">RoboFab 1.3.0a documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for ufoLib</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A library for importing .ufo files and their descendants.</span>
<span class="sd">Refer to http://unifiedfontobject.com for the UFO specification.</span>

<span class="sd">The UFOReader and UFOWriter classes support versions 1 and 2</span>
<span class="sd">of the specification. Up and down conversion functions are also</span>
<span class="sd">supplied in this library. These conversion functions are only</span>
<span class="sd">necessary if conversion without loading the UFO data into</span>
<span class="sd">a set of objects is desired. These functions are:</span>
<span class="sd">	convertUFOFormatVersion1ToFormatVersion2</span>

<span class="sd">Two sets that list the font info attribute names for the two</span>
<span class="sd">fontinfo.plist formats are available for external use. These are:</span>
<span class="sd">	fontInfoAttributesVersion1</span>
<span class="sd">	fontInfoAttributesVersion2</span>

<span class="sd">A set listing the fontinfo.plist attributes that were deprecated</span>
<span class="sd">in version 2 is available for external use:</span>
<span class="sd">	deprecatedFontInfoAttributesVersion2</span>

<span class="sd">A function, validateFontInfoVersion2ValueForAttribute, that does</span>
<span class="sd">some basic validation on values for a fontinfo.plist value is</span>
<span class="sd">available for external use.</span>

<span class="sd">Two value conversion functions are availble for converting</span>
<span class="sd">fontinfo.plist values between the possible format versions.</span>
<span class="sd">	convertFontInfoValueForAttributeFromVersion1ToVersion2</span>
<span class="sd">	convertFontInfoValueForAttributeFromVersion2ToVersion1</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">cStringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">plistlib</span> <span class="kn">import</span> <span class="n">readPlist</span><span class="p">,</span> <span class="n">writePlist</span>
<span class="kn">from</span> <span class="nn">glifLib</span> <span class="kn">import</span> <span class="n">GlyphSet</span><span class="p">,</span> <span class="n">READ_MODE</span><span class="p">,</span> <span class="n">WRITE_MODE</span>
<span class="kn">from</span> <span class="nn">validators</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">filenames</span> <span class="kn">import</span> <span class="n">userNameToFileName</span>
<span class="kn">from</span> <span class="nn">converters</span> <span class="kn">import</span> <span class="n">convertUFO1OrUFO2KerningToUFO3Kerning</span>

<span class="k">try</span><span class="p">:</span>
	<span class="nb">set</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">sets</span> <span class="kn">import</span> <span class="n">Set</span> <span class="k">as</span> <span class="nb">set</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
	<span class="s">&quot;makeUFOPath&quot;</span>
	<span class="s">&quot;UFOLibError&quot;</span><span class="p">,</span>
	<span class="s">&quot;UFOReader&quot;</span><span class="p">,</span>
	<span class="s">&quot;UFOWriter&quot;</span><span class="p">,</span>
	<span class="s">&quot;convertUFOFormatVersion1ToFormatVersion2&quot;</span><span class="p">,</span>
	<span class="s">&quot;fontInfoAttributesVersion1&quot;</span><span class="p">,</span>
	<span class="s">&quot;fontInfoAttributesVersion2&quot;</span><span class="p">,</span>
	<span class="s">&quot;deprecatedFontInfoAttributesVersion2&quot;</span><span class="p">,</span>
	<span class="s">&quot;validateFontInfoVersion2ValueForAttribute&quot;</span><span class="p">,</span>
	<span class="s">&quot;convertFontInfoValueForAttributeFromVersion1ToVersion2&quot;</span><span class="p">,</span>
	<span class="s">&quot;convertFontInfoValueForAttributeFromVersion2ToVersion1&quot;</span>
<span class="p">]</span>


<span class="k">class</span> <span class="nc">UFOLibError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span>


<span class="c"># ----------</span>
<span class="c"># File Names</span>
<span class="c"># ----------</span>

<span class="n">DEFAULT_GLYPHS_DIRNAME</span> <span class="o">=</span> <span class="s">&quot;glyphs&quot;</span>
<span class="n">DATA_DIRNAME</span> <span class="o">=</span> <span class="s">&quot;data&quot;</span>
<span class="n">IMAGES_DIRNAME</span> <span class="o">=</span> <span class="s">&quot;images&quot;</span>
<span class="n">METAINFO_FILENAME</span> <span class="o">=</span> <span class="s">&quot;metainfo.plist&quot;</span>
<span class="n">FONTINFO_FILENAME</span> <span class="o">=</span> <span class="s">&quot;fontinfo.plist&quot;</span>
<span class="n">LIB_FILENAME</span> <span class="o">=</span> <span class="s">&quot;lib.plist&quot;</span>	
<span class="n">GROUPS_FILENAME</span> <span class="o">=</span> <span class="s">&quot;groups.plist&quot;</span>
<span class="n">KERNING_FILENAME</span> <span class="o">=</span> <span class="s">&quot;kerning.plist&quot;</span>
<span class="n">FEATURES_FILENAME</span> <span class="o">=</span> <span class="s">&quot;features.fea&quot;</span>
<span class="n">LAYERCONTENTS_FILENAME</span> <span class="o">=</span> <span class="s">&quot;layercontents.plist&quot;</span>
<span class="n">LAYERINFO_FILENAME</span> <span class="o">=</span> <span class="s">&quot;layerinfo.plist&quot;</span>

<span class="n">DEFAULT_LAYER_NAME</span> <span class="o">=</span> <span class="s">&quot;public.default&quot;</span>

<span class="n">supportedUFOFormatVersions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>


<span class="c"># ----------</span>
<span class="c"># UFO Reader</span>
<span class="c"># ----------</span>

<div class="viewcode-block" id="UFOReader"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader">[docs]</a><span class="k">class</span> <span class="nc">UFOReader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;Read the various components of the .ufo.&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The specified UFO doesn&#39;t exist.&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">readMetaInfo</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span> <span class="o">=</span> <span class="bp">None</span>

	<span class="c"># properties</span>

	<span class="k">def</span> <span class="nf">_get_formatVersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span>

	<span class="n">formatVersion</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_formatVersion</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;The format version of the UFO. This is determined by reading metainfo.plist during __init__.&quot;</span><span class="p">)</span>

	<span class="c"># up conversion</span>

	<span class="k">def</span> <span class="nf">_upConvertKerning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Up convert kerning and groups in UFO 1 and 2.</span>
<span class="sd">		The data will be held internally until each bit of data</span>
<span class="sd">		has been retrieved. The conversion of both must be done</span>
<span class="sd">		at once, so the raw data is cached and an error is raised</span>
<span class="sd">		if one bit of data becomes obsolete before it is called.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">:</span>
			<span class="n">testKerning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readKerning</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">testKerning</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s">&quot;originalKerning&quot;</span><span class="p">]:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The data in kerning.plist has been modified since it was converted to UFO 3 format.&quot;</span><span class="p">)</span>
			<span class="n">testGroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readGroups</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">testGroups</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s">&quot;originalGroups&quot;</span><span class="p">]:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The data in groups.plist has been modified since it was converted to UFO 3 format.&quot;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readGroups</span><span class="p">()</span>
			<span class="n">invalidFormatMessage</span> <span class="o">=</span> <span class="s">&quot;groups.plist is not properly formatted.&quot;</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">groupName</span><span class="p">,</span> <span class="n">glyphList</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">groupName</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
				<span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glyphList</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">glyphName</span> <span class="ow">in</span> <span class="n">glyphList</span><span class="p">:</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glyphName</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
						<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
				<span class="n">kerning</span><span class="o">=</span><span class="p">{},</span>
				<span class="n">originalKerning</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_readKerning</span><span class="p">(),</span>
				<span class="n">groups</span><span class="o">=</span><span class="p">{},</span>
				<span class="n">originalGroups</span><span class="o">=</span><span class="n">groups</span>
			<span class="p">)</span>
			<span class="c"># convert kerning and groups</span>
			<span class="n">kerning</span><span class="p">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">convertUFO1OrUFO2KerningToUFO3Kerning</span><span class="p">(</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s">&quot;originalKerning&quot;</span><span class="p">],</span>
				<span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s">&quot;originalGroups&quot;</span><span class="p">])</span>
			<span class="p">)</span>
			<span class="c"># store</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s">&quot;kerning&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kerning</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s">&quot;groups&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">groups</span>

	<span class="c"># support methods</span>

	<span class="k">def</span> <span class="nf">_checkForFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">return</span> <span class="bp">False</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">True</span>

	<span class="k">def</span> <span class="nf">_readPlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read a property list. The errors that</span>
<span class="sd">		could be raised during the reading of</span>
<span class="sd">		a plist are unpredictable and/or too</span>
<span class="sd">		large to list, so, a blind try: except:</span>
<span class="sd">		is done. If an exception occurs, a</span>
<span class="sd">		UFOLibError will be raised.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">originalPath</span> <span class="o">=</span> <span class="n">path</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">readPlist</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">data</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The file </span><span class="si">%s</span><span class="s"> could not be read.&quot;</span> <span class="o">%</span> <span class="n">originalPath</span><span class="p">)</span>

<div class="viewcode-block" id="UFOReader.readBytesFromPath"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.readBytesFromPath">[docs]</a>	<span class="k">def</span> <span class="nf">readBytesFromPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns the bytes in the file at the given path.</span>
<span class="sd">		The path must be relative to the UFO path.</span>
<span class="sd">		Returns None if the file does not exist.</span>
<span class="sd">		An encoding may be passed if needed.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkForFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">READ_MODE</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
		<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="UFOReader.getReadFileForPath"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.getReadFileForPath">[docs]</a>	<span class="k">def</span> <span class="nf">getReadFileForPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns a file (or file-like) object for the</span>
<span class="sd">		file at the given path. The path must be relative</span>
<span class="sd">		to the UFO path. Returns None if the file does not exist.</span>
<span class="sd">		An encoding may be passed if needed.</span>

<span class="sd">		Note: The caller is responsible for closing the open file.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkForFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">READ_MODE</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">f</span>

	<span class="c"># metainfo.plist</span>
</div>
<div class="viewcode-block" id="UFOReader.readMetaInfo"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.readMetaInfo">[docs]</a>	<span class="k">def</span> <span class="nf">readMetaInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read metainfo.plist. Only used for internal operations.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">METAINFO_FILENAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkForFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;metainfo.plist is missing in </span><span class="si">%s</span><span class="s">. This file is required.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
		<span class="c"># should there be a blind try/except with a UFOLibError</span>
		<span class="c"># raised in except here (and elsewhere)? It would be nice to</span>
		<span class="c"># provide external callers with a single exception to catch.</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readPlist</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;maetainfo.plist is not properly formatted.&quot;</span><span class="p">)</span>
		<span class="n">formatVersion</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;formatVersion&quot;</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">formatVersion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supportedUFOFormatVersions</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Unsupported UFO format (</span><span class="si">%d</span><span class="s">) in </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">formatVersion</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">=</span> <span class="n">formatVersion</span>

	<span class="c"># groups.plist</span>
</div>
	<span class="k">def</span> <span class="nf">_readGroups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">GROUPS_FILENAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkForFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">return</span> <span class="p">{}</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readPlist</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span>

<div class="viewcode-block" id="UFOReader.readGroups"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.readGroups">[docs]</a>	<span class="k">def</span> <span class="nf">readGroups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read groups.plist. Returns a dict.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c"># handle up conversion</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertKerning</span><span class="p">()</span>
			<span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s">&quot;groups&quot;</span><span class="p">]</span>
		<span class="c"># normal</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readGroups</span><span class="p">()</span>
		<span class="n">valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">groupsValidator</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">groups</span>

	<span class="c"># fontinfo.plist</span>
</div>
	<span class="k">def</span> <span class="nf">_readInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">FONTINFO_FILENAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkForFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">return</span> <span class="p">{}</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readPlist</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;fontinfo.plist is not properly formatted.&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span>

<div class="viewcode-block" id="UFOReader.readInfo"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.readInfo">[docs]</a>	<span class="k">def</span> <span class="nf">readInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read fontinfo.plist. It requires an object that allows</span>
<span class="sd">		setting attributes with names that follow the fontinfo.plist</span>
<span class="sd">		version 3 specification. This will write the attributes</span>
<span class="sd">		defined in the file into the object.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">FONTINFO_FILENAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkForFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">return</span> <span class="p">{}</span>
		<span class="n">infoDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readPlist</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infoDict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;fontinfo.plist is not properly formatted.&quot;</span><span class="p">)</span>
		<span class="n">infoDataToSet</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="c"># version 1</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">fontInfoAttributesVersion1</span><span class="p">:</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">infoDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
					<span class="n">infoDataToSet</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
			<span class="n">infoDataToSet</span> <span class="o">=</span> <span class="n">_convertFontInfoDataVersion1ToVersion2</span><span class="p">(</span><span class="n">infoDataToSet</span><span class="p">)</span>
		<span class="c"># version 2</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">dataValidationDict</span> <span class="ow">in</span> <span class="n">fontInfoAttributesVersion2ValueData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">infoDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
					<span class="k">continue</span>
				<span class="n">infoDataToSet</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
		<span class="c"># version 3</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">dataValidationDict</span> <span class="ow">in</span> <span class="n">fontInfoAttributesVersion3ValueData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">infoDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
					<span class="k">continue</span>
				<span class="n">infoDataToSet</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
		<span class="c"># unsupported version</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">NotImplementedError</span>
		<span class="c"># validate data</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="n">infoDataToSet</span> <span class="o">=</span> <span class="n">validateInfoVersion2Data</span><span class="p">(</span><span class="n">infoDataToSet</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="n">infoDataToSet</span> <span class="o">=</span> <span class="n">validateInfoVersion3Data</span><span class="p">(</span><span class="n">infoDataToSet</span><span class="p">)</span>
		<span class="c"># populate the object</span>
		<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">infoDataToSet</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="nb">setattr</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
			<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The supplied info object does not support setting a necessary attribute (</span><span class="si">%s</span><span class="s">).&quot;</span> <span class="o">%</span> <span class="n">attr</span><span class="p">)</span>

	<span class="c"># kerning.plist</span>
</div>
	<span class="k">def</span> <span class="nf">_readKerning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">KERNING_FILENAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkForFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">return</span> <span class="p">{}</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readPlist</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="n">invalidFormatMessage</span> <span class="o">=</span> <span class="s">&quot;kerning.plist is not properly formatted.&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">first</span><span class="p">,</span> <span class="n">secondDict</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
			<span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">secondDict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">second</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">secondDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
				<span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span>

<div class="viewcode-block" id="UFOReader.readKerning"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.readKerning">[docs]</a>	<span class="k">def</span> <span class="nf">readKerning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read kerning.plist. Returns a dict.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c"># handle up conversion</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_upConvertKerning</span><span class="p">()</span>
			<span class="n">kerningNested</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upConvertedKerningData</span><span class="p">[</span><span class="s">&quot;kerning&quot;</span><span class="p">]</span>
		<span class="c"># normal</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">kerningNested</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readKerning</span><span class="p">()</span>
		<span class="c"># flatten</span>
		<span class="n">kerning</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">left</span> <span class="ow">in</span> <span class="n">kerningNested</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">kerningNested</span><span class="p">[</span><span class="n">left</span><span class="p">]:</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">kerningNested</span><span class="p">[</span><span class="n">left</span><span class="p">][</span><span class="n">right</span><span class="p">]</span>
				<span class="n">kerning</span><span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
		<span class="k">return</span> <span class="n">kerning</span>

	<span class="c"># lib.plist</span>
</div>
<div class="viewcode-block" id="UFOReader.readLib"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.readLib">[docs]</a>	<span class="k">def</span> <span class="nf">readLib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read lib.plist. Returns a dict.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">LIB_FILENAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkForFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">return</span> <span class="p">{}</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readPlist</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="n">valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">fontLibValidator</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span>

	<span class="c"># features.fea</span>
</div>
<div class="viewcode-block" id="UFOReader.readFeatures"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.readFeatures">[docs]</a>	<span class="k">def</span> <span class="nf">readFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read features.fea. Returns a string.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">FEATURES_FILENAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkForFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">return</span> <span class="s">&quot;&quot;</span>
		<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">READ_MODE</span><span class="p">)</span>
		<span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
		<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">text</span>

	<span class="c"># glyph sets &amp; layers</span>
</div>
	<span class="k">def</span> <span class="nf">_readLayerContents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Rebuild the layer contents list by checking what glyphsets</span>
<span class="sd">		are available on disk.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[(</span><span class="n">DEFAULT_LAYER_NAME</span><span class="p">,</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">)]</span>
		<span class="c"># read the file on disk</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">LAYERCONTENTS_FILENAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;layercontents.plist is missing.&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readPlist</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
			<span class="n">valid</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">layerContentsValidator</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">contents</span>

<div class="viewcode-block" id="UFOReader.getLayerNames"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.getLayerNames">[docs]</a>	<span class="k">def</span> <span class="nf">getLayerNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the ordered layer names from layercontents.plist.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">layerContents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readLayerContents</span><span class="p">()</span>
		<span class="n">layerNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">layerName</span> <span class="k">for</span> <span class="n">layerName</span><span class="p">,</span> <span class="n">directoryName</span> <span class="ow">in</span> <span class="n">layerContents</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">layerNames</span>
</div>
<div class="viewcode-block" id="UFOReader.getDefaultLayerName"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.getDefaultLayerName">[docs]</a>	<span class="k">def</span> <span class="nf">getDefaultLayerName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Get the default layer name from layercontents.plist.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">layerContents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readLayerContents</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">layerName</span><span class="p">,</span> <span class="n">layerDirectory</span> <span class="ow">in</span> <span class="n">layerContents</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">layerDirectory</span> <span class="o">==</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">layerName</span>
		<span class="c"># this will already have been raised during __init__</span>
		<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The default layer is not defined in layercontents.plist.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UFOReader.getGlyphSet"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.getGlyphSet">[docs]</a>	<span class="k">def</span> <span class="nf">getGlyphSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the GlyphSet associated with the</span>
<span class="sd">		glyphs directory mapped to layerName</span>
<span class="sd">		in the UFO. If layerName is not provided,</span>
<span class="sd">		the name retrieved with getDefaultLayerName</span>
<span class="sd">		will be used.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">layerName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefaultLayerName</span><span class="p">()</span>
		<span class="n">directory</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="n">layerContents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readLayerContents</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">storedLayerName</span><span class="p">,</span> <span class="n">storedLayerDirectory</span> <span class="ow">in</span> <span class="n">layerContents</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">layerName</span> <span class="o">==</span> <span class="n">storedLayerName</span><span class="p">:</span>
				<span class="n">directory</span> <span class="o">=</span> <span class="n">storedLayerDirectory</span>
				<span class="k">break</span>
		<span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;No glyphs directory is mapped to </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">layerName</span><span class="p">)</span>
		<span class="n">glyphsPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">GlyphSet</span><span class="p">(</span><span class="n">glyphsPath</span><span class="p">,</span> <span class="n">ufoFormatVersion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UFOReader.getCharacterMapping"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.getCharacterMapping">[docs]</a>	<span class="k">def</span> <span class="nf">getCharacterMapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return a dictionary that maps unicode values (ints) to</span>
<span class="sd">		lists of glyph names.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">glyphsPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getGlyphSet</span><span class="p">(</span><span class="n">layerName</span><span class="p">)</span>
		<span class="n">allUnicodes</span> <span class="o">=</span> <span class="n">glyphSet</span><span class="o">.</span><span class="n">getUnicodes</span><span class="p">()</span>
		<span class="n">cmap</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">unicodes</span> <span class="ow">in</span> <span class="n">allUnicodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
			<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">unicodes</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">cmap</span><span class="p">:</span>
					<span class="n">cmap</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glyphName</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">cmap</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">glyphName</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">cmap</span>

	<span class="c"># /data</span>
</div>
<div class="viewcode-block" id="UFOReader.getDataDirectoryListing"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.getDataDirectoryListing">[docs]</a>	<span class="k">def</span> <span class="nf">getDataDirectoryListing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxDepth</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns a list of all files and directories</span>
<span class="sd">		in the data directory. The returned paths will</span>
<span class="sd">		be relative to the UFO. This will not list</span>
<span class="sd">		directory names, only file names. Thus, empty</span>
<span class="sd">		directories will be skipped.</span>

<span class="sd">		The maxDepth argument sets the maximum number</span>
<span class="sd">		of sub-directories that are allowed.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">DATA_DIRNAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_checkForFile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">return</span> <span class="p">[]</span>
		<span class="n">listing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getDirectoryListing</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">maxDepth</span><span class="o">=</span><span class="n">maxDepth</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">listing</span>
</div>
	<span class="k">def</span> <span class="nf">_getDirectoryListing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxDepth</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="n">maxDepth</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Maximum recusion depth reached.&quot;</span><span class="p">)</span>
		<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
				<span class="n">result</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getDirectoryListing</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxDepth</span><span class="o">=</span><span class="n">maxDepth</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
				<span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="UFOReader.getImageDirectoryListing"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.getImageDirectoryListing">[docs]</a>	<span class="k">def</span> <span class="nf">getImageDirectoryListing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Returns a list of all image file names in</span>
<span class="sd">		the images directory. Each of the images will</span>
<span class="sd">		have been verified to have the PNG signature.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[]</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">IMAGES_DIRNAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">return</span> <span class="p">[]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The UFO contains an </span><span class="se">\&quot;</span><span class="s">images</span><span class="se">\&quot;</span><span class="s"> file instead of a directory.&quot;</span><span class="p">)</span>
		<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
				<span class="c"># silently skip this as version control</span>
				<span class="c"># systems often have hidden directories</span>
				<span class="k">continue</span>
			<span class="n">valid</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">pngValidator</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
				<span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="UFOReader.readImage"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOReader.readImage">[docs]</a>	<span class="k">def</span> <span class="nf">readImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return image data for the file named fileName.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Reading images is not allowed in UFO </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span><span class="p">)</span>
		<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readBytesFromPath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">IMAGES_DIRNAME</span><span class="p">,</span> <span class="n">fileName</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;No image file named </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">fileName</span><span class="p">)</span>
		<span class="n">valid</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">pngValidator</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">data</span>

<span class="c"># ----------</span>
<span class="c"># UFO Writer</span>
<span class="c"># ----------</span>

</div></div>
<div class="viewcode-block" id="UFOWriter"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter">[docs]</a><span class="k">class</span> <span class="nc">UFOWriter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;Write the various components of the .ufo.&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">formatVersion</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">fileCreator</span><span class="o">=</span><span class="s">&quot;org.robofab.ufoLib&quot;</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">formatVersion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supportedUFOFormatVersions</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Unsupported UFO format (</span><span class="si">%d</span><span class="s">).&quot;</span> <span class="o">%</span> <span class="n">formatVersion</span><span class="p">)</span>
		<span class="c"># establish some basic stuff</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">=</span> <span class="n">formatVersion</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_fileCreator</span> <span class="o">=</span> <span class="n">fileCreator</span>
		<span class="c"># if the file already exists, get the format version.</span>
		<span class="c"># this will be needed for up and down conversion.</span>
		<span class="n">previousFormatVersion</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">METAINFO_FILENAME</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The metainfo.plist file is not in the existing UFO.&quot;</span><span class="p">)</span>
			<span class="n">metaInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readPlist</span><span class="p">(</span><span class="n">METAINFO_FILENAME</span><span class="p">)</span>
			<span class="n">previousFormatVersion</span> <span class="o">=</span> <span class="n">metaInfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;formatVersion&quot;</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">previousFormatVersion</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">previousFormatVersion</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The existing metainfo.plist is not properly formatted.&quot;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">previousFormatVersion</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supportedUFOFormatVersions</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Unsupported UFO format (</span><span class="si">%d</span><span class="s">).&quot;</span> <span class="o">%</span> <span class="n">formatVersion</span><span class="p">)</span>
		<span class="c"># catch down conversion</span>
		<span class="k">if</span> <span class="n">previousFormatVersion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">previousFormatVersion</span> <span class="o">&gt;</span> <span class="n">formatVersion</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The UFO located at this path is a higher version (</span><span class="si">%d</span><span class="s">) than the version (</span><span class="si">%d</span><span class="s">) that is trying to be written. This is not supported.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">previousFormatVersion</span><span class="p">,</span> <span class="n">formatVersion</span><span class="p">))</span>
		<span class="c"># handle the layer contents</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">if</span> <span class="n">previousFormatVersion</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
			<span class="c"># already exists</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_readLayerContents</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c"># previous &lt; 3</span>
			<span class="c"># imply the layer contents</span>
			<span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span> <span class="o">=</span> <span class="p">{</span><span class="n">DEFAULT_LAYER_NAME</span> <span class="p">:</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">}</span>
		<span class="c"># write the new metainfo</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_writeMetaInfo</span><span class="p">()</span>

	<span class="c"># properties</span>

	<span class="k">def</span> <span class="nf">_get_formatVersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span>

	<span class="n">formatVersion</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_formatVersion</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;The format version of the UFO. This is set into metainfo.plist during __init__.&quot;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">_get_fileCreator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fileCreator</span>

	<span class="n">fileCreator</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_fileCreator</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;The file creator of the UFO. This is set into metainfo.plist during __init__.&quot;</span><span class="p">)</span>

	<span class="c"># support methods</span>

	<span class="k">def</span> <span class="nf">_readPlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Read a property list. The errors that</span>
<span class="sd">		could be raised during the reading of</span>
<span class="sd">		a plist are unpredictable and/or too</span>
<span class="sd">		large to list, so, a blind try: except:</span>
<span class="sd">		is done. If an exception occurs, a</span>
<span class="sd">		UFOLibError will be raised.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">originalPath</span> <span class="o">=</span> <span class="n">path</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">readPlist</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">data</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The file </span><span class="si">%s</span><span class="s"> could not be read.&quot;</span> <span class="o">%</span> <span class="n">originalPath</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">_writePlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write a property list. The errors that</span>
<span class="sd">		could be raised during the writing of</span>
<span class="sd">		a plist are unpredictable and/or too</span>
<span class="sd">		large to list, so, a blind try: except:</span>
<span class="sd">		is done. If an exception occurs, a</span>
<span class="sd">		UFOLibError will be raised.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">originalPath</span> <span class="o">=</span> <span class="n">path</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">writePlistAtomically</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The data for the file </span><span class="si">%s</span><span class="s"> could not be written because it is not properly formatted.&quot;</span> <span class="o">%</span> <span class="n">originalPath</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">_makeDirectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subDirectory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>
		<span class="k">if</span> <span class="n">subDirectory</span><span class="p">:</span>
			<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">subDirectory</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">path</span>

	<span class="k">def</span> <span class="nf">_buildDirectoryTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
		<span class="n">directory</span><span class="p">,</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="n">directoryTree</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">while</span> <span class="n">directory</span><span class="p">:</span>
			<span class="n">directory</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
			<span class="n">directoryTree</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
		<span class="n">directoryTree</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
		<span class="n">built</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
		<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">directoryTree</span><span class="p">:</span>
			<span class="n">d</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">built</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
			<span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
				<span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
			<span class="n">built</span> <span class="o">=</span> <span class="n">d</span>

	<span class="k">def</span> <span class="nf">_removeFileForPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">raiseErrorIfMissing</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="n">originalPath</span> <span class="o">=</span> <span class="n">path</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">raiseErrorIfMissing</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The file </span><span class="si">%s</span><span class="s"> does not exist.&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
				<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="c"># remove any directories that are now empty</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_removeEmptyDirectoriesForPath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">originalPath</span><span class="p">))</span>

	<span class="k">def</span> <span class="nf">_removeEmptyDirectoriesForPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
		<span class="n">absoluteDirectory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">absoluteDirectory</span><span class="p">):</span>
			<span class="k">return</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">absoluteDirectory</span><span class="p">)):</span>
			<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">absoluteDirectory</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span>
		<span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_removeEmptyDirectoriesForPath</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

	<span class="c"># file system interaction</span>

<div class="viewcode-block" id="UFOWriter.writeBytesToPath"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.writeBytesToPath">[docs]</a>	<span class="k">def</span> <span class="nf">writeBytesToPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write bytes to path. If needed, the directory tree</span>
<span class="sd">		for the given path will be built. The path must be</span>
<span class="sd">		relative to the UFO. An encoding may be passed if needed.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The data directory is not allowed in UFO Format Version </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_buildDirectoryTree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
		<span class="n">writeFileAtomically</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UFOWriter.getFileObjectForPath"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.getFileObjectForPath">[docs]</a>	<span class="k">def</span> <span class="nf">getFileObjectForPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Creates a write mode file object at path. If needed,</span>
<span class="sd">		the directory tree for the given path will be built.</span>
<span class="sd">		The path must be relative to the UFO. An encoding may</span>
<span class="sd">		be passed if needed.</span>

<span class="sd">		Note: The caller is responsible for closing the open file.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The data directory is not allowed in UFO Format Version </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_buildDirectoryTree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">WRITE_MODE</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UFOWriter.removeFileForPath"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.removeFileForPath">[docs]</a>	<span class="k">def</span> <span class="nf">removeFileForPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Remove the file (or directory) at path. The path</span>
<span class="sd">		must be relative to the UFO. This is only allowed</span>
<span class="sd">		for files in the data and image directories.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c"># make sure that only data or images is being changed</span>
		<span class="n">d</span> <span class="o">=</span> <span class="n">path</span>
		<span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">while</span> <span class="n">d</span><span class="p">:</span>
			<span class="n">d</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">p</span><span class="p">:</span>
				<span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;images&quot;</span><span class="p">,</span> <span class="s">&quot;data&quot;</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Removing </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s"> is not legal.&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
		<span class="c"># remove the file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_removeFileForPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">raiseErrorIfMissing</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

	<span class="c"># metainfo.plist</span>
</div>
	<span class="k">def</span> <span class="nf">_writeMetaInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_makeDirectory</span><span class="p">()</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">METAINFO_FILENAME</span><span class="p">)</span>
		<span class="n">metaInfo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
			<span class="n">creator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileCreator</span><span class="p">,</span>
			<span class="n">formatVersion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span>
		<span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_writePlist</span><span class="p">(</span><span class="n">metaInfo</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

	<span class="c"># groups.plist</span>

<div class="viewcode-block" id="UFOWriter.writeGroups"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.writeGroups">[docs]</a>	<span class="k">def</span> <span class="nf">writeGroups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write groups.plist. This method requires a</span>
<span class="sd">		dict of glyph groups as an argument.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">groupsValidator</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_makeDirectory</span><span class="p">()</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">GROUPS_FILENAME</span><span class="p">)</span>
		<span class="n">groupsNew</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="n">groupsNew</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">groupsNew</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_writePlist</span><span class="p">(</span><span class="n">groupsNew</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

	<span class="c"># fontinfo.plist</span>
</div>
<div class="viewcode-block" id="UFOWriter.writeInfo"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.writeInfo">[docs]</a>	<span class="k">def</span> <span class="nf">writeInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write info.plist. This method requires an object</span>
<span class="sd">		that supports getting attributes that follow the</span>
<span class="sd">		fontinfo.plist version 2 specification. Attributes</span>
<span class="sd">		will be taken from the given object and written</span>
<span class="sd">		into the file.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_makeDirectory</span><span class="p">()</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">FONTINFO_FILENAME</span><span class="p">)</span>
		<span class="c"># gather version 3 data</span>
		<span class="n">infoData</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">fontInfoAttributesVersion3ValueData</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The supplied info object does not support getting a necessary attribute (</span><span class="si">%s</span><span class="s">).&quot;</span> <span class="o">%</span> <span class="n">attr</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
					<span class="k">continue</span>
				<span class="n">infoData</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
		<span class="c"># down convert data if necessary and validate</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="n">infoData</span> <span class="o">=</span> <span class="n">validateInfoVersion3Data</span><span class="p">(</span><span class="n">infoData</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">infoData</span> <span class="o">=</span> <span class="n">_convertFontInfoDataVersion3ToVersion2</span><span class="p">(</span><span class="n">infoData</span><span class="p">)</span>
			<span class="n">infoData</span> <span class="o">=</span> <span class="n">validateInfoVersion2Data</span><span class="p">(</span><span class="n">infoData</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">infoData</span> <span class="o">=</span> <span class="n">_convertFontInfoDataVersion3ToVersion2</span><span class="p">(</span><span class="n">infoData</span><span class="p">)</span>
			<span class="n">infoData</span> <span class="o">=</span> <span class="n">validateInfoVersion2Data</span><span class="p">(</span><span class="n">infoData</span><span class="p">)</span>
			<span class="n">infoData</span> <span class="o">=</span> <span class="n">_convertFontInfoDataVersion2ToVersion1</span><span class="p">(</span><span class="n">infoData</span><span class="p">)</span>
		<span class="c"># write file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_writePlist</span><span class="p">(</span><span class="n">infoData</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

	<span class="c"># kerning.plist</span>
</div>
<div class="viewcode-block" id="UFOWriter.writeKerning"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.writeKerning">[docs]</a>	<span class="k">def</span> <span class="nf">writeKerning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kerning</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write kerning.plist. This method requires a</span>
<span class="sd">		dict of kerning pairs as an argument.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">invalidFormatMessage</span> <span class="o">=</span> <span class="s">&quot;The kerning is not properly formatted.&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">isDictEnough</span><span class="p">(</span><span class="n">kerning</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">pair</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kerning</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">basestring</span><span class="p">):</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">basestring</span><span class="p">):</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">invalidFormatMessage</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_makeDirectory</span><span class="p">()</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">KERNING_FILENAME</span><span class="p">)</span>
		<span class="n">kerningDict</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="n">kerning</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">kerning</span><span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">]</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">left</span> <span class="ow">in</span> <span class="n">kerningDict</span><span class="p">:</span>
				<span class="n">kerningDict</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
			<span class="n">kerningDict</span><span class="p">[</span><span class="n">left</span><span class="p">][</span><span class="n">right</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
		<span class="k">if</span> <span class="n">kerningDict</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_writePlist</span><span class="p">(</span><span class="n">kerningDict</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

	<span class="c"># lib.plist</span>
</div>
<div class="viewcode-block" id="UFOWriter.writeLib"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.writeLib">[docs]</a>	<span class="k">def</span> <span class="nf">writeLib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">libDict</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write lib.plist. This method requires a</span>
<span class="sd">		lib dict as an argument.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">fontLibValidator</span><span class="p">(</span><span class="n">libDict</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_makeDirectory</span><span class="p">()</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">LIB_FILENAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">libDict</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_writePlist</span><span class="p">(</span><span class="n">libDict</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

	<span class="c"># features.fea</span>
</div>
<div class="viewcode-block" id="UFOWriter.writeFeatures"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.writeFeatures">[docs]</a>	<span class="k">def</span> <span class="nf">writeFeatures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write features.fea. This method requires a</span>
<span class="sd">		features string as an argument.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;features.fea is not allowed in UFO Format Version 1.&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The features are not text.&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_makeDirectory</span><span class="p">()</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">FEATURES_FILENAME</span><span class="p">)</span>
		<span class="n">writeFileAtomically</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

	<span class="c"># glyph sets &amp; layers</span>
</div>
	<span class="k">def</span> <span class="nf">_readLayerContents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Rebuild the layer contents list by checking what glyph sets</span>
<span class="sd">		are available on disk.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c"># read the file on disk</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">LAYERCONTENTS_FILENAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;layercontents.plist is missing.&quot;</span><span class="p">)</span>
		<span class="n">contents</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readPlist</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
			<span class="n">valid</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">layerContentsValidator</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">:</span>
				<span class="n">layerName</span><span class="p">,</span> <span class="n">directoryName</span> <span class="o">=</span> <span class="n">entry</span>
				<span class="n">contents</span><span class="p">[</span><span class="n">layerName</span><span class="p">]</span> <span class="o">=</span> <span class="n">directoryName</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span> <span class="o">=</span> <span class="n">contents</span>

<div class="viewcode-block" id="UFOWriter.writeLayerContents"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.writeLayerContents">[docs]</a>	<span class="k">def</span> <span class="nf">writeLayerContents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerOrder</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write the layercontents.plist file. This method  *must* be called</span>
<span class="sd">		after all glyph sets have been written.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">return</span>
		<span class="n">newOrder</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">layerName</span> <span class="ow">in</span> <span class="n">layerOrder</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
				<span class="n">layerName</span> <span class="o">=</span> <span class="n">DEFAULT_LAYER_NAME</span>
			<span class="n">newOrder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layerName</span><span class="p">)</span>
		<span class="n">layerOrder</span> <span class="o">=</span> <span class="n">newOrder</span>
		<span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">layerOrder</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The layer order contents does not match the glyph sets that have been created.&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_makeDirectory</span><span class="p">()</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">LAYERCONTENTS_FILENAME</span><span class="p">)</span>
		<span class="n">layerContents</span> <span class="o">=</span> <span class="p">[(</span><span class="n">layerName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">])</span> <span class="k">for</span> <span class="n">layerName</span> <span class="ow">in</span> <span class="n">layerOrder</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_writePlist</span><span class="p">(</span><span class="n">layerContents</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</div>
	<span class="k">def</span> <span class="nf">_findDirectoryForLayerName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerName</span><span class="p">):</span>
		<span class="n">foundDirectory</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="k">for</span> <span class="n">existingLayerName</span><span class="p">,</span> <span class="n">directoryName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="k">if</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">directoryName</span> <span class="o">==</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">:</span>
				<span class="n">foundDirectory</span> <span class="o">=</span> <span class="n">directoryName</span>
				<span class="k">break</span>
			<span class="k">elif</span> <span class="n">existingLayerName</span> <span class="o">==</span> <span class="n">layerName</span><span class="p">:</span>
				<span class="n">foundDirectory</span> <span class="o">=</span> <span class="n">directoryName</span>
				<span class="k">break</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">foundDirectory</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Could not locate a glyph set directory for the layer named </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">layerName</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">foundDirectory</span>

<div class="viewcode-block" id="UFOWriter.getGlyphSet"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.getGlyphSet">[docs]</a>	<span class="k">def</span> <span class="nf">getGlyphSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerName</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">defaultLayer</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Return the GlyphSet object associated with the</span>
<span class="sd">		appropriate glyph directory in the .ufo.</span>
<span class="sd">		If layerName is None, the default glyph set</span>
<span class="sd">		will be used. The defaultLayer flag indictes</span>
<span class="sd">		that the layer should be saved into the default</span>
<span class="sd">		glyphs directory.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c"># only default can be written in &lt; 3</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">defaultLayer</span> <span class="ow">or</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Only the default layer can be writen in UFO </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span><span class="p">)</span>
		<span class="c"># locate a layer name when None has been given</span>
		<span class="k">if</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">defaultLayer</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">existingLayerName</span><span class="p">,</span> <span class="n">directory</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">directory</span> <span class="o">==</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">:</span>
					<span class="n">layerName</span> <span class="o">=</span> <span class="n">existingLayerName</span>
			<span class="k">if</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
				<span class="n">layerName</span> <span class="o">=</span> <span class="n">DEFAULT_LAYER_NAME</span>
		<span class="k">elif</span> <span class="n">layerName</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">defaultLayer</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;A layer name must be provided for non-default layers.&quot;</span><span class="p">)</span>
		<span class="c"># move along to format specific writing</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getGlyphSetFormatVersion1</span><span class="p">(</span><span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="n">glyphNameToFileNameFunc</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getGlyphSetFormatVersion2</span><span class="p">(</span><span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="n">glyphNameToFileNameFunc</span><span class="p">)</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatVersion</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getGlyphSetFormatVersion3</span><span class="p">(</span><span class="n">layerName</span><span class="o">=</span><span class="n">layerName</span><span class="p">,</span> <span class="n">defaultLayer</span><span class="o">=</span><span class="n">defaultLayer</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="n">glyphNameToFileNameFunc</span><span class="p">)</span>
</div>
	<span class="k">def</span> <span class="nf">_getGlyphSetFormatVersion1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="n">glyphDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeDirectory</span><span class="p">(</span><span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">GlyphSet</span><span class="p">(</span><span class="n">glyphDir</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="p">,</span> <span class="n">ufoFormatVersion</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">_getGlyphSetFormatVersion2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="n">glyphDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeDirectory</span><span class="p">(</span><span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">GlyphSet</span><span class="p">(</span><span class="n">glyphDir</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="p">,</span> <span class="n">ufoFormatVersion</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">_getGlyphSetFormatVersion3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerName</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">defaultLayer</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="c"># if the default flag is on, make sure that the default in the file</span>
		<span class="c"># matches the default being written. also make sure that this layer</span>
		<span class="c"># name is not already linked to a non-default layer.</span>
		<span class="k">if</span> <span class="n">defaultLayer</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">existingLayerName</span><span class="p">,</span> <span class="n">directory</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">directory</span> <span class="o">==</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">existingLayerName</span> <span class="o">!=</span> <span class="n">layerName</span><span class="p">:</span>
						<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Another layer is already mapped to the default directory.&quot;</span><span class="p">)</span>
				<span class="k">elif</span> <span class="n">existingLayerName</span> <span class="o">==</span> <span class="n">layerName</span><span class="p">:</span>
					<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The layer name is already mapped to a non-default layer.&quot;</span><span class="p">)</span>
		<span class="c"># get an existing directory name</span>
		<span class="k">if</span> <span class="n">layerName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">:</span>
			<span class="n">directory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">]</span>
		<span class="c"># get a  new directory name</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">defaultLayer</span><span class="p">:</span>
				<span class="n">directory</span> <span class="o">=</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c"># not caching this could be slightly expensive,</span>
				<span class="c"># but caching it will be cumbersome</span>
				<span class="n">existing</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layerName</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">layerName</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">layerName</span><span class="p">)</span>
					<span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
						<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The specified layer name is not a Unicode string.&quot;</span><span class="p">)</span>
				<span class="n">directory</span> <span class="o">=</span> <span class="n">userNameToFileName</span><span class="p">(</span><span class="n">layerName</span><span class="p">,</span> <span class="n">existing</span><span class="o">=</span><span class="n">existing</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;glyphs.&quot;</span><span class="p">)</span>
		<span class="c"># make the directory</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_makeDirectory</span><span class="p">(</span><span class="n">subDirectory</span><span class="o">=</span><span class="n">directory</span><span class="p">)</span>
		<span class="c"># store the mapping</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">]</span> <span class="o">=</span> <span class="n">directory</span>
		<span class="c"># load the glyph set</span>
		<span class="k">return</span> <span class="n">GlyphSet</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">glyphNameToFileNameFunc</span><span class="o">=</span><span class="n">glyphNameToFileNameFunc</span><span class="p">,</span> <span class="n">ufoFormatVersion</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<div class="viewcode-block" id="UFOWriter.renameGlyphSet"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.renameGlyphSet">[docs]</a>	<span class="k">def</span> <span class="nf">renameGlyphSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerName</span><span class="p">,</span> <span class="n">newLayerName</span><span class="p">,</span> <span class="n">defaultLayer</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Rename a glyph set.</span>

<span class="sd">		Note: if a GlyphSet object has already been retrieved for</span>
<span class="sd">		layerName, it is up to the caller to inform that object that</span>
<span class="sd">		the directory it represents has changed.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Renaming a glyph set is not allowed in UFO </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span><span class="p">)</span>
		<span class="c"># the new and old names can be the same</span>
		<span class="c"># as long as the default is being switched</span>
		<span class="k">if</span> <span class="n">layerName</span> <span class="o">==</span> <span class="n">newLayerName</span><span class="p">:</span>
			<span class="c"># if the default is off and the layer is already not the default, skip</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">]</span> <span class="o">!=</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">defaultLayer</span><span class="p">:</span>
				<span class="k">return</span>
			<span class="c"># if the default is on and the layer is already the default, skip</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">]</span> <span class="o">==</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span> <span class="ow">and</span> <span class="n">defaultLayer</span><span class="p">:</span>
				<span class="k">return</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c"># make sure the new layer name doesn&#39;t already exist</span>
			<span class="k">if</span> <span class="n">newLayerName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
				<span class="n">newLayerName</span> <span class="o">=</span> <span class="n">DEFAULT_LAYER_NAME</span>
			<span class="k">if</span> <span class="n">newLayerName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;A layer named </span><span class="si">%s</span><span class="s"> already exists.&quot;</span> <span class="o">%</span> <span class="n">newLayerName</span><span class="p">)</span>
			<span class="c"># make sure the default layer doesn&#39;t already exist</span>
			<span class="k">if</span> <span class="n">defaultLayer</span> <span class="ow">and</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;A default layer already exists.&quot;</span><span class="p">)</span>
		<span class="c"># get the paths</span>
		<span class="n">oldDirectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findDirectoryForLayerName</span><span class="p">(</span><span class="n">layerName</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">defaultLayer</span><span class="p">:</span>
			<span class="n">newDirectory</span> <span class="o">=</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">existing</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
			<span class="n">newDirectory</span> <span class="o">=</span> <span class="n">userNameToFileName</span><span class="p">(</span><span class="n">newLayerName</span><span class="p">,</span> <span class="n">existing</span><span class="o">=</span><span class="n">existing</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;glyphs.&quot;</span><span class="p">)</span>
		<span class="c"># update the internal mapping</span>
		<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">newLayerName</span><span class="p">]</span> <span class="o">=</span> <span class="n">newDirectory</span>
		<span class="c"># do the file system copy</span>
		<span class="n">oldDirectory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">oldDirectory</span><span class="p">)</span>
		<span class="n">newDirectory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">newDirectory</span><span class="p">)</span>
		<span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">oldDirectory</span><span class="p">,</span> <span class="n">newDirectory</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UFOWriter.deleteGlyphSet"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.deleteGlyphSet">[docs]</a>	<span class="k">def</span> <span class="nf">deleteGlyphSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layerName</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Remove the glyph set matching layerName.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Deleting a glyph set is not allowed in UFO </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span><span class="p">)</span>
		<span class="n">foundDirectory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findDirectoryForLayerName</span><span class="p">(</span><span class="n">layerName</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_removeFileForPath</span><span class="p">(</span><span class="n">foundDirectory</span><span class="p">)</span>
		<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerContents</span><span class="p">[</span><span class="n">layerName</span><span class="p">]</span>

	<span class="c"># /images</span>
</div>
<div class="viewcode-block" id="UFOWriter.writeImage"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.writeImage">[docs]</a>	<span class="k">def</span> <span class="nf">writeImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Write data to fileName in the images directory.</span>
<span class="sd">		The data must be a valid PNG.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Images are not allowed in UFO </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span><span class="p">)</span>
		<span class="n">valid</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">pngValidator</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">IMAGES_DIRNAME</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">writeBytesToPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UFOWriter.removeImage"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.UFOWriter.removeImage">[docs]</a>	<span class="k">def</span> <span class="nf">removeImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Remove the file named fileName from the</span>
<span class="sd">		images directory.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Images are not allowed in UFO </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatVersion</span><span class="p">)</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">IMAGES_DIRNAME</span><span class="p">,</span> <span class="n">fileName</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">removeFileForPath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c"># ----------------</span>
<span class="c"># Helper Functions</span>
<span class="c"># ----------------</span>
</div></div>
<span class="k">def</span> <span class="nf">makeUFOPath</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Return a .ufo pathname.</span>

<span class="sd">	&gt;&gt;&gt; makeUFOPath(&quot;/directory/something.ext&quot;)</span>
<span class="sd">	&#39;/directory/something.ufo&#39;</span>
<span class="sd">	&gt;&gt;&gt; makeUFOPath(&quot;/directory/something.another.thing.ext&quot;)</span>
<span class="sd">	&#39;/directory/something.another.thing.ufo&#39;</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="nb">dir</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
	<span class="n">name</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="s">&quot;ufo&quot;</span><span class="p">])</span>
	<span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">writePlistAtomically</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Write a plist for &quot;obj&quot; to &quot;path&quot;. Do this sort of atomically,</span>
<span class="sd">	making it harder to cause corrupt files, for example when writePlist</span>
<span class="sd">	encounters an error halfway during write. This also checks to see</span>
<span class="sd">	if text matches the text that is already in the file at path.</span>
<span class="sd">	If so, the file is not rewritten so that the modification date</span>
<span class="sd">	is preserved.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">f</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
	<span class="n">writePlist</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
	<span class="n">writeFileAtomically</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">writeFileAtomically</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Write text into a file at path. Do this sort of atomically</span>
<span class="sd">	making it harder to cause corrupt files. This also checks to see</span>
<span class="sd">	if text matches the text that is already in the file at path.</span>
<span class="sd">	If so, the file is not rewritten so that the modification date</span>
<span class="sd">	is preserved. An encoding may be passed if needed.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
		<span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">READ_MODE</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
		<span class="n">oldText</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
		<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="n">oldText</span><span class="p">:</span>
			<span class="k">return</span>
		<span class="c"># if the text is empty, remove the existing file</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
			<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">text</span><span class="p">:</span>
		<span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">WRITE_MODE</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
		<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
		<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># ---------------------------</span>
<span class="c"># Format Conversion Functions</span>
<span class="c"># ---------------------------</span>

<div class="viewcode-block" id="convertUFOFormatVersion1ToFormatVersion2"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.convertUFOFormatVersion1ToFormatVersion2">[docs]</a><span class="k">def</span> <span class="nf">convertUFOFormatVersion1ToFormatVersion2</span><span class="p">(</span><span class="n">inPath</span><span class="p">,</span> <span class="n">outPath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Function for converting a version format 1 UFO</span>
<span class="sd">	to version format 2. inPath should be a path</span>
<span class="sd">	to a UFO. outPath is the path where the new UFO</span>
<span class="sd">	should be written. If outPath is not given, the</span>
<span class="sd">	inPath will be used and, therefore, the UFO will</span>
<span class="sd">	be converted in place. Otherwise, if outPath is</span>
<span class="sd">	specified, nothing must exist at that path.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">outPath</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
		<span class="n">outPath</span> <span class="o">=</span> <span class="n">inPath</span>
	<span class="k">if</span> <span class="n">inPath</span> <span class="o">!=</span> <span class="n">outPath</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outPath</span><span class="p">):</span>
		<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;A file already exists at </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="n">outPath</span><span class="p">)</span>
	<span class="c"># use a reader for loading most of the data</span>
	<span class="n">reader</span> <span class="o">=</span> <span class="n">UFOReader</span><span class="p">(</span><span class="n">inPath</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">reader</span><span class="o">.</span><span class="n">formatVersion</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
		<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;The UFO at </span><span class="si">%s</span><span class="s"> is already format version 2.&quot;</span> <span class="o">%</span> <span class="n">inPath</span><span class="p">)</span>
	<span class="n">groups</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readGroups</span><span class="p">()</span>
	<span class="n">kerning</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readKerning</span><span class="p">()</span>
	<span class="n">libData</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">readLib</span><span class="p">()</span>
	<span class="c"># read the info data manually and convert</span>
	<span class="n">infoPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">inPath</span><span class="p">,</span> <span class="n">FONTINFO_FILENAME</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">infoPath</span><span class="p">):</span>
		<span class="n">infoData</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">infoData</span> <span class="o">=</span> <span class="n">readPlist</span><span class="p">(</span><span class="n">infoPath</span><span class="p">)</span>
	<span class="n">infoData</span> <span class="o">=</span> <span class="n">_convertFontInfoDataVersion1ToVersion2</span><span class="p">(</span><span class="n">infoData</span><span class="p">)</span>
	<span class="c"># if the paths are the same, only need to change the</span>
	<span class="c"># fontinfo and meta info files.</span>
	<span class="n">infoPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outPath</span><span class="p">,</span> <span class="n">FONTINFO_FILENAME</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">inPath</span> <span class="o">==</span> <span class="n">outPath</span><span class="p">:</span>
		<span class="n">metaInfoPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">inPath</span><span class="p">,</span> <span class="n">METAINFO_FILENAME</span><span class="p">)</span>
		<span class="n">metaInfo</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
			<span class="n">creator</span><span class="o">=</span><span class="s">&quot;org.robofab.ufoLib&quot;</span><span class="p">,</span>
			<span class="n">formatVersion</span><span class="o">=</span><span class="mi">2</span>
		<span class="p">)</span>
		<span class="n">writePlistAtomically</span><span class="p">(</span><span class="n">metaInfo</span><span class="p">,</span> <span class="n">metaInfoPath</span><span class="p">)</span>
		<span class="n">writePlistAtomically</span><span class="p">(</span><span class="n">infoData</span><span class="p">,</span> <span class="n">infoPath</span><span class="p">)</span>
	<span class="c"># otherwise write everything.</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">writer</span> <span class="o">=</span> <span class="n">UFOWriter</span><span class="p">(</span><span class="n">outPath</span><span class="p">,</span> <span class="n">formatVersion</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeGroups</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeKerning</span><span class="p">(</span><span class="n">kerning</span><span class="p">)</span>
		<span class="n">writer</span><span class="o">.</span><span class="n">writeLib</span><span class="p">(</span><span class="n">libData</span><span class="p">)</span>
		<span class="c"># write the info manually</span>
		<span class="n">writePlistAtomically</span><span class="p">(</span><span class="n">infoData</span><span class="p">,</span> <span class="n">infoPath</span><span class="p">)</span>
		<span class="c"># copy the glyph tree</span>
		<span class="n">inGlyphs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">inPath</span><span class="p">,</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">)</span>
		<span class="n">outGlyphs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outPath</span><span class="p">,</span> <span class="n">DEFAULT_GLYPHS_DIRNAME</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">inGlyphs</span><span class="p">):</span>
			<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">inGlyphs</span><span class="p">,</span> <span class="n">outGlyphs</span><span class="p">)</span>

<span class="c"># ----------------------</span>
<span class="c"># fontinfo.plist Support</span>
<span class="c"># ----------------------</span>

<span class="c"># Version Validators</span>

<span class="c"># There is no version 1 validator and there shouldn&#39;t be.</span>
<span class="c"># The version 1 spec was very loose and there were numerous</span>
<span class="c"># cases of invalid values.</span>
</div>
<div class="viewcode-block" id="validateFontInfoVersion2ValueForAttribute"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.validateFontInfoVersion2ValueForAttribute">[docs]</a><span class="k">def</span> <span class="nf">validateFontInfoVersion2ValueForAttribute</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This performs very basic validation of the value for attribute</span>
<span class="sd">	following the UFO 2 fontinfo.plist specification. The results</span>
<span class="sd">	of this should not be interpretted as *correct* for the font</span>
<span class="sd">	that they are part of. This merely indicates that the value</span>
<span class="sd">	is of the proper type and, where the specification defines</span>
<span class="sd">	a set range of possible values for an attribute, that the</span>
<span class="sd">	value is in the accepted range.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">dataValidationDict</span> <span class="o">=</span> <span class="n">fontInfoAttributesVersion2ValueData</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
	<span class="n">valueType</span> <span class="o">=</span> <span class="n">dataValidationDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span>
	<span class="n">validator</span> <span class="o">=</span> <span class="n">dataValidationDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;valueValidator&quot;</span><span class="p">)</span>
	<span class="n">valueOptions</span> <span class="o">=</span> <span class="n">dataValidationDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;valueOptions&quot;</span><span class="p">)</span>
	<span class="c"># have specific options for the validator</span>
	<span class="k">if</span> <span class="n">valueOptions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
		<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valueOptions</span><span class="p">)</span>
	<span class="c"># no specific options</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">validator</span> <span class="o">==</span> <span class="n">genericTypeValidator</span><span class="p">:</span>
			<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valueType</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">isValidValue</span>
</div>
<span class="k">def</span> <span class="nf">validateInfoVersion2Data</span><span class="p">(</span><span class="n">infoData</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This performs very basic validation of the value for infoData</span>
<span class="sd">	following the UFO 2 fontinfo.plist specification. The results</span>
<span class="sd">	of this should not be interpretted as *correct* for the font</span>
<span class="sd">	that they are part of. This merely indicates that the values</span>
<span class="sd">	are of the proper type and, where the specification defines</span>
<span class="sd">	a set range of possible values for an attribute, that the</span>
<span class="sd">	value is in the accepted range.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">validInfoData</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">infoData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validateFontInfoVersion2ValueForAttribute</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">isValidValue</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Invalid value for attribute </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">).&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">validInfoData</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
	<span class="k">return</span> <span class="n">validInfoData</span>

<span class="k">def</span> <span class="nf">validateFontInfoVersion3ValueForAttribute</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This performs very basic validation of the value for attribute</span>
<span class="sd">	following the UFO 3 fontinfo.plist specification. The results</span>
<span class="sd">	of this should not be interpretted as *correct* for the font</span>
<span class="sd">	that they are part of. This merely indicates that the value</span>
<span class="sd">	is of the proper type and, where the specification defines</span>
<span class="sd">	a set range of possible values for an attribute, that the</span>
<span class="sd">	value is in the accepted range.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">dataValidationDict</span> <span class="o">=</span> <span class="n">fontInfoAttributesVersion3ValueData</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
	<span class="n">valueType</span> <span class="o">=</span> <span class="n">dataValidationDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span>
	<span class="n">validator</span> <span class="o">=</span> <span class="n">dataValidationDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;valueValidator&quot;</span><span class="p">)</span>
	<span class="n">valueOptions</span> <span class="o">=</span> <span class="n">dataValidationDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;valueOptions&quot;</span><span class="p">)</span>
	<span class="c"># have specific options for the validator</span>
	<span class="k">if</span> <span class="n">valueOptions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
		<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valueOptions</span><span class="p">)</span>
	<span class="c"># no specific options</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">validator</span> <span class="o">==</span> <span class="n">genericTypeValidator</span><span class="p">:</span>
			<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valueType</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">isValidValue</span>

<span class="k">def</span> <span class="nf">validateInfoVersion3Data</span><span class="p">(</span><span class="n">infoData</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This performs very basic validation of the value for infoData</span>
<span class="sd">	following the UFO 3 fontinfo.plist specification. The results</span>
<span class="sd">	of this should not be interpretted as *correct* for the font</span>
<span class="sd">	that they are part of. This merely indicates that the values</span>
<span class="sd">	are of the proper type and, where the specification defines</span>
<span class="sd">	a set range of possible values for an attribute, that the</span>
<span class="sd">	value is in the accepted range.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">validInfoData</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">infoData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="n">isValidValue</span> <span class="o">=</span> <span class="n">validateFontInfoVersion3ValueForAttribute</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">isValidValue</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Invalid value for attribute </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">).&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">validInfoData</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
	<span class="k">return</span> <span class="n">validInfoData</span>

<span class="c"># Value Options</span>

<span class="n">fontInfoOpenTypeHeadFlagsOptions</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">fontInfoOpenTypeOS2SelectionOptions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">fontInfoOpenTypeOS2UnicodeRangesOptions</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
<span class="n">fontInfoOpenTypeOS2CodePageRangesOptions</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">fontInfoOpenTypeOS2TypeOptions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>

<span class="c"># Version Attribute Definitions</span>
<span class="c"># This defines the attributes, types and, in some</span>
<span class="c"># cases the possible values, that can exist is</span>
<span class="c"># fontinfo.plist.</span>

<span class="n">fontInfoAttributesVersion1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span>
	<span class="s">&quot;familyName&quot;</span><span class="p">,</span>
	<span class="s">&quot;styleName&quot;</span><span class="p">,</span>
	<span class="s">&quot;fullName&quot;</span><span class="p">,</span>
	<span class="s">&quot;fontName&quot;</span><span class="p">,</span>
	<span class="s">&quot;menuName&quot;</span><span class="p">,</span>
	<span class="s">&quot;fontStyle&quot;</span><span class="p">,</span>
	<span class="s">&quot;note&quot;</span><span class="p">,</span>
	<span class="s">&quot;versionMajor&quot;</span><span class="p">,</span>
	<span class="s">&quot;versionMinor&quot;</span><span class="p">,</span>
	<span class="s">&quot;year&quot;</span><span class="p">,</span>
	<span class="s">&quot;copyright&quot;</span><span class="p">,</span>
	<span class="s">&quot;notice&quot;</span><span class="p">,</span>
	<span class="s">&quot;trademark&quot;</span><span class="p">,</span>
	<span class="s">&quot;license&quot;</span><span class="p">,</span>
	<span class="s">&quot;licenseURL&quot;</span><span class="p">,</span>
	<span class="s">&quot;createdBy&quot;</span><span class="p">,</span>
	<span class="s">&quot;designer&quot;</span><span class="p">,</span>
	<span class="s">&quot;designerURL&quot;</span><span class="p">,</span>
	<span class="s">&quot;vendorURL&quot;</span><span class="p">,</span>
	<span class="s">&quot;unitsPerEm&quot;</span><span class="p">,</span>
	<span class="s">&quot;ascender&quot;</span><span class="p">,</span>
	<span class="s">&quot;descender&quot;</span><span class="p">,</span>
	<span class="s">&quot;capHeight&quot;</span><span class="p">,</span>
	<span class="s">&quot;xHeight&quot;</span><span class="p">,</span>
	<span class="s">&quot;defaultWidth&quot;</span><span class="p">,</span>
	<span class="s">&quot;slantAngle&quot;</span><span class="p">,</span>
	<span class="s">&quot;italicAngle&quot;</span><span class="p">,</span>
	<span class="s">&quot;widthName&quot;</span><span class="p">,</span>
	<span class="s">&quot;weightName&quot;</span><span class="p">,</span>
	<span class="s">&quot;weightValue&quot;</span><span class="p">,</span>
	<span class="s">&quot;fondName&quot;</span><span class="p">,</span>
	<span class="s">&quot;otFamilyName&quot;</span><span class="p">,</span>
	<span class="s">&quot;otStyleName&quot;</span><span class="p">,</span>
	<span class="s">&quot;otMacName&quot;</span><span class="p">,</span>
	<span class="s">&quot;msCharSet&quot;</span><span class="p">,</span>
	<span class="s">&quot;fondID&quot;</span><span class="p">,</span>
	<span class="s">&quot;uniqueID&quot;</span><span class="p">,</span>
	<span class="s">&quot;ttVendor&quot;</span><span class="p">,</span>
	<span class="s">&quot;ttUniqueID&quot;</span><span class="p">,</span>
	<span class="s">&quot;ttVersion&quot;</span><span class="p">,</span>
<span class="p">])</span>

<span class="n">fontInfoAttributesVersion2ValueData</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;familyName&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;styleName&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;styleMapFamilyName&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;styleMapStyleName&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoStyleMapStyleNameValidator</span><span class="p">),</span>
	<span class="s">&quot;versionMajor&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s">&quot;versionMinor&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s">&quot;year&quot;</span>									<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s">&quot;copyright&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;trademark&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;unitsPerEm&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;descender&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;xHeight&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;capHeight&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;ascender&quot;</span>								<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;italicAngle&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>
	<span class="s">&quot;note&quot;</span>									<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeHeadCreated&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoOpenTypeHeadCreatedValidator</span><span class="p">),</span>
	<span class="s">&quot;openTypeHeadLowestRecPPEM&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeHeadFlags&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericIntListValidator</span><span class="p">,</span> <span class="n">valueOptions</span><span class="o">=</span><span class="n">fontInfoOpenTypeHeadFlagsOptions</span><span class="p">),</span>
	<span class="s">&quot;openTypeHheaAscender&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeHheaDescender&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeHheaLineGap&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeHheaCaretSlopeRise&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s">&quot;openTypeHheaCaretSlopeRun&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s">&quot;openTypeHheaCaretOffset&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeNameDesigner&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNameDesignerURL&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNameManufacturer&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNameManufacturerURL&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNameLicense&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNameLicenseURL&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNameVersion&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNameUniqueID&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNameDescription&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNamePreferredFamilyName&quot;</span>		<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNamePreferredSubfamilyName&quot;</span>	<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNameCompatibleFullName&quot;</span>		<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNameSampleText&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNameWWSFamilyName&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeNameWWSSubfamilyName&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeOS2WidthClass&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2WidthClassValidator</span><span class="p">),</span>
	<span class="s">&quot;openTypeOS2WeightClass&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2WeightClassValidator</span><span class="p">),</span>
	<span class="s">&quot;openTypeOS2Selection&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericIntListValidator</span><span class="p">,</span> <span class="n">valueOptions</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2SelectionOptions</span><span class="p">),</span>
	<span class="s">&quot;openTypeOS2VendorID&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;openTypeOS2Panose&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoVersion2OpenTypeOS2PanoseValidator</span><span class="p">),</span>
	<span class="s">&quot;openTypeOS2FamilyClass&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2FamilyClassValidator</span><span class="p">),</span>
	<span class="s">&quot;openTypeOS2UnicodeRanges&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericIntListValidator</span><span class="p">,</span> <span class="n">valueOptions</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2UnicodeRangesOptions</span><span class="p">),</span>
	<span class="s">&quot;openTypeOS2CodePageRanges&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericIntListValidator</span><span class="p">,</span> <span class="n">valueOptions</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2CodePageRangesOptions</span><span class="p">),</span>
	<span class="s">&quot;openTypeOS2TypoAscender&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2TypoDescender&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2TypoLineGap&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2WinAscent&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2WinDescent&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2Type&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericIntListValidator</span><span class="p">,</span> <span class="n">valueOptions</span><span class="o">=</span><span class="n">fontInfoOpenTypeOS2TypeOptions</span><span class="p">),</span>
	<span class="s">&quot;openTypeOS2SubscriptXSize&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2SubscriptYSize&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2SubscriptXOffset&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2SubscriptYOffset&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2SuperscriptXSize&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2SuperscriptYSize&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2SuperscriptXOffset&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2SuperscriptYOffset&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2StrikeoutSize&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeOS2StrikeoutPosition&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeVheaVertTypoAscender&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeVheaVertTypoDescender&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeVheaVertTypoLineGap&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;openTypeVheaCaretSlopeRise&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s">&quot;openTypeVheaCaretSlopeRun&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s">&quot;openTypeVheaCaretOffset&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;postscriptFontName&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;postscriptFullName&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;postscriptSlantAngle&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>
	<span class="s">&quot;postscriptUniqueID&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s">&quot;postscriptUnderlineThickness&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;postscriptUnderlinePosition&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;postscriptIsFixedPitch&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">bool</span><span class="p">),</span>
	<span class="s">&quot;postscriptBlueValues&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptBluesValidator</span><span class="p">),</span>
	<span class="s">&quot;postscriptOtherBlues&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptOtherBluesValidator</span><span class="p">),</span>
	<span class="s">&quot;postscriptFamilyBlues&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptBluesValidator</span><span class="p">),</span>
	<span class="s">&quot;postscriptFamilyOtherBlues&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptOtherBluesValidator</span><span class="p">),</span>
	<span class="s">&quot;postscriptStemSnapH&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptStemsValidator</span><span class="p">),</span>
	<span class="s">&quot;postscriptStemSnapV&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptStemsValidator</span><span class="p">),</span>
	<span class="s">&quot;postscriptBlueFuzz&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;postscriptBlueShift&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;postscriptBlueScale&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)),</span>
	<span class="s">&quot;postscriptForceBold&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">bool</span><span class="p">),</span>
	<span class="s">&quot;postscriptDefaultWidthX&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;postscriptNominalWidthX&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)),</span>
	<span class="s">&quot;postscriptWeightName&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;postscriptDefaultCharacter&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
	<span class="s">&quot;postscriptWindowsCharacterSet&quot;</span>			<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoPostscriptWindowsCharacterSetValidator</span><span class="p">),</span>
	<span class="s">&quot;macintoshFONDFamilyID&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
	<span class="s">&quot;macintoshFONDName&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">basestring</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">fontInfoAttributesVersion2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fontInfoAttributesVersion2ValueData</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">fontInfoAttributesVersion3ValueData</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">fontInfoAttributesVersion2ValueData</span><span class="p">)</span>
<span class="n">fontInfoAttributesVersion3ValueData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
	<span class="s">&quot;versionMinor&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeIntValidator</span><span class="p">),</span>
	<span class="s">&quot;unitsPerEm&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeNumberValidator</span><span class="p">),</span>
	<span class="s">&quot;openTypeHeadLowestRecPPEM&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeNumberValidator</span><span class="p">),</span>
	<span class="s">&quot;openTypeOS2Panose&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;integerList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoVersion3OpenTypeOS2PanoseValidator</span><span class="p">),</span>
	<span class="s">&quot;openTypeOS2WinAscent&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeNumberValidator</span><span class="p">),</span>
	<span class="s">&quot;openTypeOS2WinDescent&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeNumberValidator</span><span class="p">),</span>
	<span class="s">&quot;openTypeGaspRangeRecords&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;dictList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoOpenTypeGaspRangeRecordsValidator</span><span class="p">),</span>
	<span class="s">&quot;openTypeNameRecords&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&quot;dictList&quot;</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoOpenTypeNameRecordsValidator</span><span class="p">),</span>
	<span class="s">&quot;woffMajorVersion&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeIntValidator</span><span class="p">),</span>
	<span class="s">&quot;woffMinorVersion&quot;</span>						<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">genericNonNegativeIntValidator</span><span class="p">),</span>
	<span class="s">&quot;woffMetadataUniqueID&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataUniqueIDValidator</span><span class="p">),</span>
	<span class="s">&quot;woffMetadataVendor&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataVendorValidator</span><span class="p">),</span>
	<span class="s">&quot;woffMetadataCredits&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataCreditsValidator</span><span class="p">),</span>
	<span class="s">&quot;woffMetadataDescription&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataDescriptionValidator</span><span class="p">),</span>
	<span class="s">&quot;woffMetadataLicense&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataLicenseValidator</span><span class="p">),</span>
	<span class="s">&quot;woffMetadataCopyright&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataCopyrightValidator</span><span class="p">),</span>
	<span class="s">&quot;woffMetadataTrademark&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataTrademarkValidator</span><span class="p">),</span>
	<span class="s">&quot;woffMetadataLicensee&quot;</span>					<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataLicenseeValidator</span><span class="p">),</span>
	<span class="s">&quot;woffMetadataExtensions&quot;</span>				<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">fontInfoWOFFMetadataExtensionsValidator</span><span class="p">),</span>
	<span class="s">&quot;guidelines&quot;</span>							<span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">valueValidator</span><span class="o">=</span><span class="n">guidelinesValidator</span><span class="p">)</span>
<span class="p">})</span>
<span class="n">fontInfoAttributesVersion3</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fontInfoAttributesVersion3ValueData</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c"># insert the type validator for all attrs that</span>
<span class="c"># have no defined validator.</span>
<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">dataDict</span> <span class="ow">in</span> <span class="n">fontInfoAttributesVersion2ValueData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
	<span class="k">if</span> <span class="s">&quot;valueValidator&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dataDict</span><span class="p">:</span>
		<span class="n">dataDict</span><span class="p">[</span><span class="s">&quot;valueValidator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">genericTypeValidator</span>

<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">dataDict</span> <span class="ow">in</span> <span class="n">fontInfoAttributesVersion3ValueData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
	<span class="k">if</span> <span class="s">&quot;valueValidator&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dataDict</span><span class="p">:</span>
		<span class="n">dataDict</span><span class="p">[</span><span class="s">&quot;valueValidator&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">genericTypeValidator</span>

<span class="c"># Version Conversion Support</span>
<span class="c"># These are used from converting from version 1</span>
<span class="c"># to version 2 or vice-versa.</span>

<span class="k">def</span> <span class="nf">_flipDict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
	<span class="n">flipped</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="n">flipped</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
	<span class="k">return</span> <span class="n">flipped</span>

<span class="n">fontInfoAttributesVersion1To2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;menuName&quot;</span>		<span class="p">:</span> <span class="s">&quot;styleMapFamilyName&quot;</span><span class="p">,</span>
	<span class="s">&quot;designer&quot;</span>		<span class="p">:</span> <span class="s">&quot;openTypeNameDesigner&quot;</span><span class="p">,</span>
	<span class="s">&quot;designerURL&quot;</span>	<span class="p">:</span> <span class="s">&quot;openTypeNameDesignerURL&quot;</span><span class="p">,</span>
	<span class="s">&quot;createdBy&quot;</span>		<span class="p">:</span> <span class="s">&quot;openTypeNameManufacturer&quot;</span><span class="p">,</span>
	<span class="s">&quot;vendorURL&quot;</span>		<span class="p">:</span> <span class="s">&quot;openTypeNameManufacturerURL&quot;</span><span class="p">,</span>
	<span class="s">&quot;license&quot;</span>		<span class="p">:</span> <span class="s">&quot;openTypeNameLicense&quot;</span><span class="p">,</span>
	<span class="s">&quot;licenseURL&quot;</span>	<span class="p">:</span> <span class="s">&quot;openTypeNameLicenseURL&quot;</span><span class="p">,</span>
	<span class="s">&quot;ttVersion&quot;</span>		<span class="p">:</span> <span class="s">&quot;openTypeNameVersion&quot;</span><span class="p">,</span>
	<span class="s">&quot;ttUniqueID&quot;</span>	<span class="p">:</span> <span class="s">&quot;openTypeNameUniqueID&quot;</span><span class="p">,</span>
	<span class="s">&quot;notice&quot;</span>		<span class="p">:</span> <span class="s">&quot;openTypeNameDescription&quot;</span><span class="p">,</span>
	<span class="s">&quot;otFamilyName&quot;</span>	<span class="p">:</span> <span class="s">&quot;openTypeNamePreferredFamilyName&quot;</span><span class="p">,</span>
	<span class="s">&quot;otStyleName&quot;</span>	<span class="p">:</span> <span class="s">&quot;openTypeNamePreferredSubfamilyName&quot;</span><span class="p">,</span>
	<span class="s">&quot;otMacName&quot;</span>		<span class="p">:</span> <span class="s">&quot;openTypeNameCompatibleFullName&quot;</span><span class="p">,</span>
	<span class="s">&quot;weightName&quot;</span>	<span class="p">:</span> <span class="s">&quot;postscriptWeightName&quot;</span><span class="p">,</span>
	<span class="s">&quot;weightValue&quot;</span>	<span class="p">:</span> <span class="s">&quot;openTypeOS2WeightClass&quot;</span><span class="p">,</span>
	<span class="s">&quot;ttVendor&quot;</span>		<span class="p">:</span> <span class="s">&quot;openTypeOS2VendorID&quot;</span><span class="p">,</span>
	<span class="s">&quot;uniqueID&quot;</span>		<span class="p">:</span> <span class="s">&quot;postscriptUniqueID&quot;</span><span class="p">,</span>
	<span class="s">&quot;fontName&quot;</span>		<span class="p">:</span> <span class="s">&quot;postscriptFontName&quot;</span><span class="p">,</span>
	<span class="s">&quot;fondID&quot;</span>		<span class="p">:</span> <span class="s">&quot;macintoshFONDFamilyID&quot;</span><span class="p">,</span>
	<span class="s">&quot;fondName&quot;</span>		<span class="p">:</span> <span class="s">&quot;macintoshFONDName&quot;</span><span class="p">,</span>
	<span class="s">&quot;defaultWidth&quot;</span>	<span class="p">:</span> <span class="s">&quot;postscriptDefaultWidthX&quot;</span><span class="p">,</span>
	<span class="s">&quot;slantAngle&quot;</span>	<span class="p">:</span> <span class="s">&quot;postscriptSlantAngle&quot;</span><span class="p">,</span>
	<span class="s">&quot;fullName&quot;</span>		<span class="p">:</span> <span class="s">&quot;postscriptFullName&quot;</span><span class="p">,</span>
	<span class="c"># require special value conversion</span>
	<span class="s">&quot;fontStyle&quot;</span>		<span class="p">:</span> <span class="s">&quot;styleMapStyleName&quot;</span><span class="p">,</span>
	<span class="s">&quot;widthName&quot;</span>		<span class="p">:</span> <span class="s">&quot;openTypeOS2WidthClass&quot;</span><span class="p">,</span>
	<span class="s">&quot;msCharSet&quot;</span>		<span class="p">:</span> <span class="s">&quot;postscriptWindowsCharacterSet&quot;</span>
<span class="p">}</span>
<span class="n">fontInfoAttributesVersion2To1</span> <span class="o">=</span> <span class="n">_flipDict</span><span class="p">(</span><span class="n">fontInfoAttributesVersion1To2</span><span class="p">)</span>
<span class="n">deprecatedFontInfoAttributesVersion2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fontInfoAttributesVersion1To2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">_fontStyle1To2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">64</span> <span class="p">:</span> <span class="s">&quot;regular&quot;</span><span class="p">,</span>
	<span class="mi">1</span>  <span class="p">:</span> <span class="s">&quot;italic&quot;</span><span class="p">,</span>
	<span class="mi">32</span> <span class="p">:</span> <span class="s">&quot;bold&quot;</span><span class="p">,</span>
	<span class="mi">33</span> <span class="p">:</span> <span class="s">&quot;bold italic&quot;</span>
<span class="p">}</span>
<span class="n">_fontStyle2To1</span> <span class="o">=</span> <span class="n">_flipDict</span><span class="p">(</span><span class="n">_fontStyle1To2</span><span class="p">)</span>
<span class="c"># Some UFO 1 files have 0</span>
<span class="n">_fontStyle1To2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;regular&quot;</span>

<span class="n">_widthName1To2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Ultra-condensed&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
	<span class="s">&quot;Extra-condensed&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
	<span class="s">&quot;Condensed&quot;</span>		  <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
	<span class="s">&quot;Semi-condensed&quot;</span>  <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
	<span class="s">&quot;Medium (normal)&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
	<span class="s">&quot;Semi-expanded&quot;</span>	  <span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
	<span class="s">&quot;Expanded&quot;</span>		  <span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
	<span class="s">&quot;Extra-expanded&quot;</span>  <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
	<span class="s">&quot;Ultra-expanded&quot;</span>  <span class="p">:</span> <span class="mi">9</span>
<span class="p">}</span>
<span class="n">_widthName2To1</span> <span class="o">=</span> <span class="n">_flipDict</span><span class="p">(</span><span class="n">_widthName1To2</span><span class="p">)</span>
<span class="c"># FontLab&#39;s default width value is &quot;Normal&quot;.</span>
<span class="c"># Many format version 1 UFOs will have this.</span>
<span class="n">_widthName1To2</span><span class="p">[</span><span class="s">&quot;Normal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c"># FontLab has an &quot;All&quot; width value. In UFO 1</span>
<span class="c"># move this up to &quot;Normal&quot;.</span>
<span class="n">_widthName1To2</span><span class="p">[</span><span class="s">&quot;All&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c"># &quot;medium&quot; appears in a lot of UFO 1 files.</span>
<span class="n">_widthName1To2</span><span class="p">[</span><span class="s">&quot;medium&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c"># &quot;Medium&quot; appears in a lot of UFO 1 files.</span>
<span class="n">_widthName1To2</span><span class="p">[</span><span class="s">&quot;Medium&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">_msCharSet1To2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">0</span>	<span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
	<span class="mi">1</span>	<span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
	<span class="mi">2</span>	<span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
	<span class="mi">77</span>	<span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
	<span class="mi">128</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
	<span class="mi">129</span> <span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
	<span class="mi">130</span> <span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
	<span class="mi">134</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
	<span class="mi">136</span> <span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
	<span class="mi">161</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
	<span class="mi">162</span> <span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
	<span class="mi">163</span> <span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
	<span class="mi">177</span> <span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
	<span class="mi">178</span> <span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
	<span class="mi">186</span> <span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
	<span class="mi">200</span> <span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
	<span class="mi">204</span> <span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
	<span class="mi">222</span> <span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
	<span class="mi">238</span> <span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
	<span class="mi">255</span> <span class="p">:</span> <span class="mi">20</span>
<span class="p">}</span>
<span class="n">_msCharSet2To1</span> <span class="o">=</span> <span class="n">_flipDict</span><span class="p">(</span><span class="n">_msCharSet1To2</span><span class="p">)</span>

<div class="viewcode-block" id="convertFontInfoValueForAttributeFromVersion1ToVersion2"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.convertFontInfoValueForAttributeFromVersion1ToVersion2">[docs]</a><span class="k">def</span> <span class="nf">convertFontInfoValueForAttributeFromVersion1ToVersion2</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Convert value from version 1 to version 2 format.</span>
<span class="sd">	Returns the new attribute name and the converted value.</span>
<span class="sd">	If the value is None, None will be returned for the new value.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c"># convert floats to ints if possible</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
		<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
			<span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;fontStyle&quot;</span><span class="p">:</span>
			<span class="n">v</span> <span class="o">=</span> <span class="n">_fontStyle1To2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Cannot convert value (</span><span class="si">%s</span><span class="s">) for attribute </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">attr</span><span class="p">))</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">v</span>
		<span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;widthName&quot;</span><span class="p">:</span>
			<span class="n">v</span> <span class="o">=</span> <span class="n">_widthName1To2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Cannot convert value (</span><span class="si">%s</span><span class="s">) for attribute </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">attr</span><span class="p">))</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">v</span>
		<span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;msCharSet&quot;</span><span class="p">:</span>
			<span class="n">v</span> <span class="o">=</span> <span class="n">_msCharSet1To2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
				<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Cannot convert value (</span><span class="si">%s</span><span class="s">) for attribute </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">attr</span><span class="p">))</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">v</span>
	<span class="n">attr</span> <span class="o">=</span> <span class="n">fontInfoAttributesVersion1To2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="convertFontInfoValueForAttributeFromVersion2ToVersion1"><a class="viewcode-back" href="../ufoLib/ufoLib.html#ufoLib.convertFontInfoValueForAttributeFromVersion2ToVersion1">[docs]</a><span class="k">def</span> <span class="nf">convertFontInfoValueForAttributeFromVersion2ToVersion1</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Convert value from version 2 to version 1 format.</span>
<span class="sd">	Returns the new attribute name and the converted value.</span>
<span class="sd">	If the value is None, None will be returned for the new value.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;styleMapStyleName&quot;</span><span class="p">:</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">_fontStyle2To1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;openTypeOS2WidthClass&quot;</span><span class="p">:</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">_widthName2To1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;postscriptWindowsCharacterSet&quot;</span><span class="p">:</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">_msCharSet2To1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
	<span class="n">attr</span> <span class="o">=</span> <span class="n">fontInfoAttributesVersion2To1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span>
</div>
<span class="k">def</span> <span class="nf">_convertFontInfoDataVersion1ToVersion2</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
	<span class="n">converted</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="c"># FontLab gives -1 for the weightValue</span>
		<span class="c"># for fonts wil no defined value. Many</span>
		<span class="c"># format version 1 UFOs will have this.</span>
		<span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&quot;weightValue&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="n">newAttr</span><span class="p">,</span> <span class="n">newValue</span> <span class="o">=</span> <span class="n">convertFontInfoValueForAttributeFromVersion1ToVersion2</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
		<span class="c"># skip if the attribute is not part of version 2</span>
		<span class="k">if</span> <span class="n">newAttr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fontInfoAttributesVersion2</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="c"># catch values that can&#39;t be converted</span>
		<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Cannot convert value (</span><span class="si">%s</span><span class="s">) for attribute </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">newAttr</span><span class="p">))</span>
		<span class="c"># store</span>
		<span class="n">converted</span><span class="p">[</span><span class="n">newAttr</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span>
	<span class="k">return</span> <span class="n">converted</span>

<span class="k">def</span> <span class="nf">_convertFontInfoDataVersion2ToVersion1</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
	<span class="n">converted</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="n">newAttr</span><span class="p">,</span> <span class="n">newValue</span> <span class="o">=</span> <span class="n">convertFontInfoValueForAttributeFromVersion2ToVersion1</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
		<span class="c"># only take attributes that are registered for version 1</span>
		<span class="k">if</span> <span class="n">newAttr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fontInfoAttributesVersion1</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="c"># catch values that can&#39;t be converted</span>
		<span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="n">UFOLibError</span><span class="p">(</span><span class="s">&quot;Cannot convert value (</span><span class="si">%s</span><span class="s">) for attribute </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">newAttr</span><span class="p">))</span>
		<span class="c"># store</span>
		<span class="n">converted</span><span class="p">[</span><span class="n">newAttr</span><span class="p">]</span> <span class="o">=</span> <span class="n">newValue</span>
	<span class="k">return</span> <span class="n">converted</span>

<span class="k">def</span> <span class="nf">_convertFontInfoDataVersion3ToVersion2</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
	<span class="n">converted</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="c"># only take attributes that are registered for version 2</span>
		<span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fontInfoAttributesVersion2</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="c"># store</span>
		<span class="n">converted</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
	<span class="k">return</span> <span class="n">converted</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">doctest</span>
	<span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">RoboFab 1.3.0a documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Tal Leming, Erik van Blokland, Just van Rossum.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.
    </div>
  </body>
</html>