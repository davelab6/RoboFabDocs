

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>robofab.pens.filterPen &mdash; RoboFab 1.3.0a documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.3.0a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="RoboFab 1.3.0a documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">RoboFab 1.3.0a documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for robofab.pens.filterPen</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">=============================</span>
<span class="sd">Filters: chaining pen objects</span>
<span class="sd">=============================</span>

<span class="sd">By chaining two (or more) pen objects together, the first pen can function as a filter to the second. The first pen receives data from (for instance) glyph.draw() or glyph.drawPoints(). The filter pen then processes the data and passes new, fresh data to the second pen. In turn the second pen can draw in a glyph. </span>

<span class="sd">Filterpens need to be initialised with a second pen object that will receive the processed data. The examples in this module, ThresholdPen and FlattenPen, have proven useful in a number of projects. For convenienve, each pen has a wrapper function that takes care of making a new glyph to dump the processed data in, and making the appropriate pen instances. But these are non-normative examples.</span>

<span class="sd">All pens in this module subclass from fontTools.pens.basePen.</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">from</span> <span class="nn">fontTools.pens.basePen</span> <span class="kn">import</span> <span class="n">AbstractPen</span><span class="p">,</span> <span class="n">BasePen</span>



<span class="kn">from</span> <span class="nn">ufoLib.pointPen</span> <span class="kn">import</span> <span class="n">AbstractPointPen</span>
<span class="kn">from</span> <span class="nn">robofab.objects.objectsRF</span> <span class="kn">import</span> <span class="n">RGlyph</span> <span class="k">as</span> <span class="n">_RGlyph</span>
<span class="kn">from</span> <span class="nn">robofab.objects.objectsBase</span> <span class="kn">import</span> <span class="n">_interpolatePt</span>

<span class="kn">import</span> <span class="nn">math</span>


<span class="c">#</span>
<span class="c">#	 threshold filtering</span>
<span class="c">#</span>

<span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>


<div class="viewcode-block" id="ThresholdPen"><a class="viewcode-back" href="../../../pens/filterPen.html#robofab.pens.filterPen.ThresholdPen">[docs]</a><span class="k">class</span> <span class="nc">ThresholdPen</span><span class="p">(</span><span class="n">AbstractPen</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;This pen only draws segments longer in length than the threshold value.	</span>

<span class="sd">		- otherPen: a different segment pen object this filter should draw the results with.</span>
<span class="sd">		- threshold: the minimum length of a segment</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">otherPen</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_lastPt</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span> <span class="o">=</span> <span class="n">otherPen</span>

	<span class="k">def</span> <span class="nf">moveTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_lastPt</span> <span class="o">=</span> <span class="n">pt</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">moveTo</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
	
	<span class="k">def</span> <span class="nf">lineTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">&lt;=</span> <span class="n">distance</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastPt</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_lastPt</span> <span class="o">=</span> <span class="n">pt</span>
		
	<span class="k">def</span> <span class="nf">curveTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">&lt;=</span> <span class="n">distance</span><span class="p">(</span><span class="n">pt3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastPt</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">curveTo</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_lastPt</span> <span class="o">=</span> <span class="n">pt3</span>

	<span class="k">def</span> <span class="nf">qCurveTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">points</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">&lt;=</span> <span class="n">distance</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastPt</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">qCurveTo</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_lastPt</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		
	<span class="k">def</span> <span class="nf">closePath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">closePath</span><span class="p">()</span>
	
	<span class="k">def</span> <span class="nf">endPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">endPath</span><span class="p">()</span>
		
	<span class="k">def</span> <span class="nf">addComponent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">transformation</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">addComponent</span><span class="p">(</span><span class="n">glyphName</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="thresholdGlyph"><a class="viewcode-back" href="../../../pens/filterPen.html#robofab.pens.filterPen.thresholdGlyph">[docs]</a><span class="k">def</span> <span class="nf">thresholdGlyph</span><span class="p">(</span><span class="n">aGlyph</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
	
	<span class="sd">&quot;&quot;&quot;Convenience function that applies the **ThresholdPen** to a glyph. Returns a new glyph object (from objectsRF.RGlyph).&quot;&quot;&quot;</span>
	
	<span class="kn">from</span> <span class="nn">robofab.pens.adapterPens</span> <span class="kn">import</span> <span class="n">PointToSegmentPen</span>
	<span class="n">new</span> <span class="o">=</span> <span class="n">_RGlyph</span><span class="p">()</span>
	<span class="n">filterpen</span> <span class="o">=</span> <span class="n">ThresholdPen</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">getPen</span><span class="p">(),</span> <span class="n">threshold</span><span class="p">)</span>
	<span class="n">wrappedPen</span> <span class="o">=</span> <span class="n">PointToSegmentPen</span><span class="p">(</span><span class="n">filterpen</span><span class="p">)</span>
	<span class="n">aGlyph</span><span class="o">.</span><span class="n">drawPoints</span><span class="p">(</span><span class="n">wrappedPen</span><span class="p">)</span>
	<span class="n">aGlyph</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
	<span class="n">aGlyph</span><span class="o">.</span><span class="n">appendGlyph</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
	<span class="n">aGlyph</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">aGlyph</span>
	
<span class="c">#</span>
<span class="c"># Curve flattening</span>
<span class="c">#</span>
</div>
<span class="k">def</span> <span class="nf">_estimateCubicCurveLength</span><span class="p">(</span><span class="n">pt0</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Estimate the length of this curve by iterating</span>
<span class="sd">	through it and averaging the length of the flat bits.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">step</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">precision</span>
	<span class="n">factors</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">precision</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">:</span>
		<span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_getCubicPoint</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">step</span><span class="p">,</span> <span class="n">pt0</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">))</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
		<span class="n">pta</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="n">ptb</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">length</span> <span class="o">+=</span> <span class="n">distance</span><span class="p">(</span><span class="n">pta</span><span class="p">,</span> <span class="n">ptb</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">length</span>

<span class="k">def</span> <span class="nf">_mid</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)):</span>
	<span class="sd">&quot;&quot;&quot;(Point, Point) -&gt; Point\nReturn the point that lies in between the two input points.&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">x1</span><span class="p">),</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">y1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_getCubicPoint</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pt0</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">pt0</span>
	<span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">pt3</span>
	<span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">:</span>
		<span class="n">a</span> <span class="o">=</span> <span class="n">_mid</span><span class="p">(</span><span class="n">pt0</span><span class="p">,</span> <span class="n">pt1</span><span class="p">)</span>
		<span class="n">b</span> <span class="o">=</span> <span class="n">_mid</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">_mid</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)</span>
		<span class="n">d</span> <span class="o">=</span> <span class="n">_mid</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
		<span class="n">e</span> <span class="o">=</span> <span class="n">_mid</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">_mid</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">cx</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">3</span>
		<span class="n">cy</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt0</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">3</span>
		<span class="n">bx</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">cx</span>
		<span class="n">by</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">cy</span>
		<span class="n">ax</span> <span class="o">=</span> <span class="n">pt3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">cx</span> <span class="o">-</span> <span class="n">bx</span>
		<span class="n">ay</span> <span class="o">=</span> <span class="n">pt3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pt0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">by</span>
		<span class="n">t3</span> <span class="o">=</span> <span class="n">t</span> <span class="o">**</span> <span class="mi">3</span>
		<span class="n">t2</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span>
		<span class="n">x</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">*</span> <span class="n">t3</span> <span class="o">+</span> <span class="n">bx</span> <span class="o">*</span> <span class="n">t2</span> <span class="o">+</span> <span class="n">cx</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">pt0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">y</span> <span class="o">=</span> <span class="n">ay</span> <span class="o">*</span> <span class="n">t3</span> <span class="o">+</span> <span class="n">by</span> <span class="o">*</span> <span class="n">t2</span> <span class="o">+</span> <span class="n">cy</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">pt0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>


<div class="viewcode-block" id="FlattenPen"><a class="viewcode-back" href="../../../pens/filterPen.html#robofab.pens.filterPen.FlattenPen">[docs]</a><span class="k">class</span> <span class="nc">FlattenPen</span><span class="p">(</span><span class="n">BasePen</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;This filter pen processes the contours into a series of straight lines by flattening the curves.</span>
<span class="sd">	</span>
<span class="sd">		- otherPen: a different segment pen object this filter should draw the results with.</span>
<span class="sd">		- approximateSegmentLength: the length you want the flattened segments to be (roughly).</span>
<span class="sd">		- segmentLines: whether to cut straight lines into segments as well.</span>
<span class="sd">		- filterDoubles: don&#39;t draw if a segment goes to the same coordinate.</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">otherPen</span><span class="p">,</span> <span class="n">approximateSegmentLength</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">segmentLines</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">filterDoubles</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">approximateSegmentLength</span> <span class="o">=</span> <span class="n">approximateSegmentLength</span>
		<span class="n">BasePen</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">{})</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span> <span class="o">=</span> <span class="n">otherPen</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">firstPt</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">segmentLines</span> <span class="o">=</span> <span class="n">segmentLines</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filterDoubles</span> <span class="o">=</span> <span class="n">filterDoubles</span>

	<span class="k">def</span> <span class="nf">_moveTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">moveTo</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span> <span class="o">=</span> <span class="n">pt</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">firstPt</span> <span class="o">=</span> <span class="n">pt</span>

	<span class="k">def</span> <span class="nf">_lineTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterDoubles</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">pt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span><span class="p">:</span>
				<span class="k">return</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentLines</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span> <span class="o">=</span> <span class="n">pt</span>
			<span class="k">return</span>
		<span class="n">d</span> <span class="o">=</span> <span class="n">distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span><span class="p">,</span> <span class="n">pt</span><span class="p">)</span>
		<span class="n">maxSteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">d</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">approximateSegmentLength</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">maxSteps</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span> <span class="o">=</span> <span class="n">pt</span>
			<span class="k">return</span>
		<span class="n">step</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">maxSteps</span>
		<span class="n">factors</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxSteps</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">_interpolatePt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">step</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span> <span class="o">=</span> <span class="n">pt</span>

	<span class="k">def</span> <span class="nf">_curveToOne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">):</span>
		<span class="n">est</span> <span class="o">=</span> <span class="n">_estimateCubicCurveLength</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">approximateSegmentLength</span>
		<span class="n">maxSteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">est</span><span class="p">))</span>
		<span class="n">falseCurve</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt1</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pt2</span><span class="o">==</span><span class="n">pt3</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">maxSteps</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">falseCurve</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt3</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span> <span class="o">=</span> <span class="n">pt3</span>
			<span class="k">return</span>
		<span class="n">step</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">maxSteps</span>
		<span class="n">factors</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxSteps</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
			<span class="n">pt</span> <span class="o">=</span> <span class="n">_getCubicPoint</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span> <span class="o">=</span> <span class="n">pt3</span>
		
	<span class="k">def</span> <span class="nf">_closePath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstPt</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">closePath</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span> <span class="o">=</span> <span class="bp">None</span>
	
	<span class="k">def</span> <span class="nf">_endPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">endPath</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">currentPt</span> <span class="o">=</span> <span class="bp">None</span>
		
	<span class="k">def</span> <span class="nf">addComponent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glyphName</span><span class="p">,</span> <span class="n">transformation</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">otherPen</span><span class="o">.</span><span class="n">addComponent</span><span class="p">(</span><span class="n">glyphName</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="flattenGlyph"><a class="viewcode-back" href="../../../pens/filterPen.html#robofab.pens.filterPen.flattenGlyph">[docs]</a><span class="k">def</span> <span class="nf">flattenGlyph</span><span class="p">(</span><span class="n">aGlyph</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">segmentLines</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;Convenience function that applies the **FlattenPen** pen to a glyph. Returns a new glyph object.&quot;&quot;&quot;</span>

	<span class="kn">from</span> <span class="nn">robofab.pens.adapterPens</span> <span class="kn">import</span> <span class="n">PointToSegmentPen</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aGlyph</span><span class="o">.</span><span class="n">contours</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">return</span>
	<span class="n">new</span> <span class="o">=</span> <span class="n">_RGlyph</span><span class="p">()</span>
	<span class="n">writerPen</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">getPen</span><span class="p">()</span>
	<span class="n">filterpen</span> <span class="o">=</span> <span class="n">FlattenPen</span><span class="p">(</span><span class="n">writerPen</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">segmentLines</span><span class="p">)</span>
	<span class="n">wrappedPen</span> <span class="o">=</span> <span class="n">PointToSegmentPen</span><span class="p">(</span><span class="n">filterpen</span><span class="p">)</span>
	<span class="n">aGlyph</span><span class="o">.</span><span class="n">drawPoints</span><span class="p">(</span><span class="n">wrappedPen</span><span class="p">)</span>
	<span class="n">aGlyph</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
	<span class="n">aGlyph</span><span class="o">.</span><span class="n">appendGlyph</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
	<span class="n">aGlyph</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">aGlyph</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">RoboFab 1.3.0a documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Tal Leming, Erik van Blokland, Just van Rossum.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.
    </div>
  </body>
</html>